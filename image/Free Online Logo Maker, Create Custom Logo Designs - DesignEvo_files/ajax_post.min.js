var loginStatus=false;var AjaxPost={ajaxCheckLogin:function(){jQuery.ajax({type:"POST",url:"/index.php?option=com_designevo&task=user.checkState",data:{},success:function(response){response=response.substring(response.lastIndexOf("{'"));var obj=new Function("return"+response)();if(obj.result==true){loginStatus=true;PanelFunc.closeLoginSignup();if(typeof updateState=="function"){if(obj.subscribed)updateState(1);else updateState(0)}if(jQuery("#reset-div").length>0){window.location.href="/"}else{AjaxPost.setUserInfo(obj);PanelFunc.hideLoginBtn()}if(jQuery(".promo_page").length>0){try{updatePromotion(obj)}catch(e){}}}else{PanelFunc.showLoginBtn()}}})},ajaxLogin:function(){var svProgress=jQuery("div[name='save_progress']")[0];var signinSubmit=jQuery("button[name='signinSubmit']");var signinText=jQuery("button[name='signinSubmit']")[0].innerHTML;svProgress.style.display="block";signinSubmit[0].innerHTML="";signinSubmit.addClass("processing-green-btn");if(!PopupFunc.validateSignIn()){svProgress.style.display="none";signinSubmit[0].innerHTML=signinText;signinSubmit.removeClass("processing-green-btn");return}var email=jQuery("input[name='username']")[0];var pswd=jQuery("input[name='password']")[0];var remember=jQuery("#remember").hasClass("designevo-checkbox-btn-checked");var captcha="";try{if(typeof grecaptcha!=="undefined")captcha=grecaptcha?grecaptcha.getResponse(window.gcSignIn):""}catch(e){}jQuery.ajax({type:"POST",url:"/index.php?option=com_designevo&task=user.login",data:{email:email.value,pswd:pswd.value,remember:remember,recaptcha:captcha},success:function(response){svProgress.style.display="none";signinSubmit[0].innerHTML=signinText;signinSubmit.removeClass("processing-green-btn");response=response.substring(response.lastIndexOf("{'"));var obj=new Function("return"+response)();if(obj.result==true){loginStatus=true;if(jQuery("#reset-div").length>0){window.location.href="/"}else{PanelFunc.closeModal();AjaxPost.setUserInfo(obj);PanelFunc.hideLoginBtn()}if(remember){CookieFunc.setCookie("designevo_remember",true);CookieFunc.setCookie("designevo_usertoken",obj.remembertoken)}else{CookieFunc.delCookie("designevo_remember");CookieFunc.delCookie("designevo_usertoken")}if(jQuery(".promo_page").length>0){try{updatePromotion(obj)}catch(e){}}jQuery("#rcSignInContainer").hide()}else{if(obj.needCaptcha)jQuery("#rcSignInContainer").show();else jQuery("#rcSignInContainer").hide();if(typeof updateState=="function"){updateState(-1)}pswd.value="";var usernametip=jQuery("span[name='usernametip']")[0];var passwordtip=jQuery("span[name='passwordtip']")[0];usernametip.style.display="none";passwordtip.style.display="none";var span_signintip=jQuery("span[name='span_signintip']")[0];span_signintip.innerHTML=obj.error;var signintip=jQuery("div[name='signintip']")[0];signintip.style.display="block"}if(typeof grecaptcha!=="undefined"&&grecaptcha)grecaptcha.reset(window.gcSignIn)},error:function(){var signInTip=jQuery(".designevo-login-tip-append").filter('[data-name="signInTip"]');jQuery(signInTip).show().find("span").html("Login failed, please check your network and try again.");svProgress.style.display="none";signinSubmit[0].innerHTML=signinText;signinSubmit.removeClass("processing-green-btn");if(typeof grecaptcha!=="undefined"&&grecaptcha)grecaptcha.reset(window.gcSignIn)}})},showAlert:function(msg){document.getElementById("alert_msg").innerHTML=msg;PanelFunc.showModal("alert")},ajaxRegister:function(){var svProgress=jQuery("div[name='save_progress']")[1];var signupSubmit=jQuery("button[name='signupSubmit']");var signupText=jQuery("button[name='signupSubmit']")[0].innerHTML;svProgress.style.display="block";signupSubmit[0].innerHTML="";signupSubmit.addClass("processing-green-btn");if(!PopupFunc.validateSignUp()){svProgress.style.display="none";signupSubmit[0].innerHTML=signupText;signupSubmit.removeClass("processing-green-btn");return}var email=jQuery("input[name='username']")[1];var pswd=jQuery("input[name='password']")[1];var emailService=jQuery("#emailService")[0];emailService.href="http://www."+email.value.substr(email.value.indexOf("@")+1);var captcha="";try{if(typeof grecaptcha!=="undefined")captcha=grecaptcha?grecaptcha.getResponse(window.gcSignUp):""}catch(e){}jQuery.ajax({type:"POST",url:"/index.php?option=com_designevo&task=registration.register",data:{email:email.value,pswd:pswd.value,recaptcha:captcha},success:function(response){svProgress.style.display="none";signupSubmit[0].innerHTML=signupText;signupSubmit.removeClass("processing-green-btn");response=response.substring(response.lastIndexOf("{'"));var obj=new Function("return"+response)();if(obj.result==true){loginStatus=true;PanelFunc.closeLoginSignup();AjaxPost.setUserInfo(obj);PanelFunc.hideLoginBtn();PanelFunc.showModal("signup_complete");if(jQuery("#reset-div").length>0){setTimeout(redirectToHome(),5e3);function redirectToHome(){window.location.href="/"}}else{var swfRef=document.DesignEvo||window.DesignEvo;if(swfRef&&swfRef.updateUserState){swfRef.updateUserState(response)}if(typeof updateState=="function"){updateState(0)}}if(jQuery(".promo_page").length>0){try{updatePromotion(obj)}catch(e){}}}else{var signuptip=jQuery("div[name='signuptip']")[0];var usernametip=jQuery("span[name='usernametip']")[1];var passwordtip=jQuery("span[name='passwordtip']")[1];passwordtip.style.display="none";switch(obj.type){case"email":{signuptip.style.display="none";usernametip.innerHTML=obj.error;usernametip.style.display="block";break}case"register":{usernametip.style.display="none";var span_signuptip=jQuery("span[name='span_signuptip']")[0];span_signuptip.innerHTML=obj.error;signuptip.style.display="block";break}case"login":{PanelFunc.closeLoginSignup();AjaxPost.showAlert(LocalFunc._("registerLoginFailed"));break}default:break}}if(typeof grecaptcha!=="undefined"&&grecaptcha)grecaptcha.reset(window.gcSignUp)},error:function(){var signUpTip=jQuery(".designevo-login-tip-append").filter('[data-name="signUpTip"]');jQuery(signUpTip).show().find("span").html(LocalFunc._("registerConnectTip"));svProgress.style.display="none";signupSubmit[0].innerHTML=signupText;signupSubmit.removeClass("processing-green-btn");if(typeof grecaptcha!=="undefined"&&grecaptcha)grecaptcha.reset(window.gcSignUp)}})},ajaxConnectFacebook:function(token,oldHtml){var idx=0;if(PanelFunc.modalVisible("signup"))idx=1;var btnFacebook=jQuery("button[name='btnFacebook']")[idx];var progress=jQuery("div[name='fb_progress']")[idx];var oldHtml=oldHtml?oldHtml:jQuery(btnFacebook).html();jQuery(btnFacebook).html("");jQuery.ajax({type:"POST",url:"/index.php?option=com_designevo&task=registration.connectFacebookUser",data:{token:token},success:function(respon){jQuery(progress).hide();jQuery(btnFacebook).html(oldHtml);respon=respon.substring(respon.lastIndexOf("{'"));var obj=new Function("return"+respon)();if(obj.result==true){loginStatus=true;if(jQuery("#reset-div").length>0){window.location.href="/"}else{PanelFunc.closeLoginSignup();AjaxPost.setUserInfo(obj);PanelFunc.hideLoginBtn()}if(obj.register==true){var emailService=jQuery("#emailService")[0];emailService.href="http://www."+obj.userEmail.substr(obj.userEmail.indexOf("@")+1);PanelFunc.showModal("signup_complete");if(jQuery("#reset-div").length>0){setTimeout(redirectToHome(),5e3);function redirectToHome(){window.location.href="/"}}}if(jQuery(".promo_page").length>0){try{updatePromotion(obj)}catch(e){}}}else{var usernametip=jQuery("span[name='usernametip']")[0];var passwordtip=jQuery("span[name='passwordtip']")[0];usernametip.style.display="none";passwordtip.style.display="none";var signuptips=jQuery("div[name='signuptip']");var signintips=jQuery("div[name='signintip']");if(signintips.length==2){var span_signintip=jQuery("span[name='span_signintip']")[0];span_signintip.innerHTML=obj.error;signintips[0].style.display="block"}else if(signuptips.length==2){var span_signuptip=jQuery("span[name='span_signuptip']")[0];span_signuptip.innerHTML=obj.error;signuptips[0].style.display="block"}}},error:function(){jQuery(progress).hide();jQuery(btnFacebook).html(oldHtml);if(idx==1){var signInTip=jQuery(".designevo-login-tip-append").filter('[data-name="signInTip"]');jQuery(signInTip).show().find("span").html(LocalFunc._("fbConnectTip"))}else{var signInTip=jQuery(".designevo-login-tip-append").filter('[data-name="signInTip"]');jQuery(signInTip).show().find("span").html(LocalFunc._("fbConnectTip"))}}})},ajaxConnectGoogle:function(token){var idx=0;if(PanelFunc.modalVisible("signup"))idx=1;var btnGoogle=jQuery("button[name='btnGoogle']")[idx];var progress=jQuery("div[name='gl_progress']")[idx];jQuery(btnGoogle).html("");jQuery.ajax({type:"POST",url:"/index.php?option=com_designevo&task=registration.connectGoogleUser",data:{token:token},success:function(respon){jQuery(progress).hide();jQuery(btnGoogle).html(loginGoogleFunc.glBtnHtml);respon=respon.substring(respon.lastIndexOf("{'"));var obj=new Function("return"+respon)();if(obj.result==true){loginStatus=true;if(jQuery("#reset-div").length>0){window.location.href="/"}else{PanelFunc.closeLoginSignup();AjaxPost.setUserInfo(obj);PanelFunc.hideLoginBtn()}if(obj.register==true){var emailService=jQuery("#emailService")[0];emailService.href="http://www."+obj.userEmail.substr(obj.userEmail.indexOf("@")+1);PanelFunc.showModal("signup_complete");if(jQuery("#reset-div").length>0){setTimeout(redirectToHome(),5e3);function redirectToHome(){window.location.href="/"}}}if(jQuery(".promo_page").length>0){try{updatePromotion(obj)}catch(e){}}}else{var usernametip=jQuery("span[name='usernametip']")[0];var passwordtip=jQuery("span[name='passwordtip']")[0];usernametip.style.display="none";passwordtip.style.display="none";var signuptips=jQuery("div[name='signuptip']");var signintips=jQuery("div[name='signintip']");if(signintips.length==2){var span_signintip=jQuery("span[name='span_signintip']")[0];span_signintip.innerHTML=obj.error;signintips[0].style.display="block"}else if(signuptips.length==2){var span_signuptip=jQuery("span[name='span_signuptip']")[0];span_signuptip.innerHTML=obj.error;signuptips[0].style.display="block"}}},error:function(){jQuery(progress).hide();jQuery(btnGoogle).html(loginGoogleFunc.glBtnHtml);if(idx==1){var signInTip=jQuery(".designevo-login-tip-append").filter('[data-name="signInTip"]');jQuery(signInTip).show().find("span").html(LocalFunc._("glConnectTip"))}else{var signInTip=jQuery(".designevo-login-tip-append").filter('[data-name="signInTip"]');jQuery(signInTip).show().find("span").html(LocalFunc._("glConnectTip"))}}})},ajaxLogout:function(event){stopDefault(event);jQuery.ajax({type:"POST",url:"/index.php?option=com_designevo&task=user.logout",data:{},success:function(respon){respon=respon.substring(respon.lastIndexOf("{'"));var obj=new Function("return"+respon)();if(obj.result==false){if(obj.error)AjaxPost.showAlert(obj.error);else AjaxPost.showAlert("Logout failed, please check your network and try again.")}else{loginStatus=false;if(jQuery("#profile-div").length>0){window.location.href="/"}else{PanelFunc.showLoginBtn();if(window.appLogoutCallback){window.appLogoutCallback("Logout")}}}},error:function(){AjaxPost.showAlert(LocalFunc._("logoutConnectTip"))}})},setUserInfo:function(data){document.getElementById("user_name").innerHTML=data.userEmail;document.getElementById("imgAvatar").src=document.getElementById("imgAvatarThumb").src=data.img;window.userInfo={img:data.img,userName:data.username,userEmail:data.userEmail};if(window.appLoginCallback){window.appLoginCallback()}if(window.packageLoginCallback){window.packageLoginCallback()}}};AjaxPost.ajaxCheckLogin(true);